###############################################################################
# quilc-base Docker image
###############################################################################
FROM rigetticomputing/lisp-base

###############################################################################
# quilc dependencies setup
###############################################################################

# organize the source
# NOTE: only works if alexa, and magicl, cl-quil, and quilc are in the same directory
ADD alexa /src/alexa
ADD magicl /src/magicl
ADD cl-quil /src/cl-quil
ADD quilc /src/quilc

###############################################################################
# quilc setup
###############################################################################

ARG build_target

# build quilc
WORKDIR /src/quilc
RUN sbcl --eval "(ql:quickload :quilc)" --quit
RUN make ${build_target}
