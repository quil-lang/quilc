include:
  - project: rigetti/ci
    file: pipelines/docker.gitlab-ci.yml

variables:
  IMAGE: rigetti/quilc

test-cl-quil:
  stage: test
  tags:
    - github
  only:
    - branches
  image: rigetti/quicklisp
  script:
    - make dump-version-info
    - make install-test-deps
    - make test-cl-quil

test-quilc:
  stage: test
  tags:
    - github
  only:
    - branches
  image: rigetti/quicklisp
  script:
    - make dump-version-info
    - make install-test-deps
    # clone rpcq to work around QuickLisp
    - pushd /builds/rigetti && rm -rf rpcq && git clone https://github.com/rigetti/rpcq.git && popd
    - make test-quilc
